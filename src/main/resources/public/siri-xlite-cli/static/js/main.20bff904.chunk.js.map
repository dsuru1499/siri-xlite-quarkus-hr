{"version":3,"sources":["reducers.js","store.js","services/SiriService.js","services/StopPointsDiscoveryService.js","types.js","services/StopMonitoringService.js","actions.js","components/stop-monitoring/StopMonitoringComponent.jsx","components/stop-points-discovery/StopPointsDiscoveryComponent.jsx","App.js","index.js"],"names":["reducers","handleActions","LINES_DISCOVERY/SUCCESS","state","action","Object","objectSpread","linesDiscovery","payload","LINES_DISCOVERY/FAILURE","STOP_POINTS_DISCOVERY/SUCCESS","stopPointsDiscovery","STOP_POINTS_DISCOVERY/FAILURE","STOP_MONITORING/SUCCESS","result","stopMonitoring","meta","name","STOP_MONITORING/FAILURE","ESTIMATED_TIMETABLE/SUCCESS","estimatedTimetable","ESTIMATED_TIMETABLE/FAILURE","store","createStore","applyMiddleware","thunk","logger","SiriService","get","url","request","from","fetch","headers","Accept","then","response","ok","json","status","Promise","reject","errorCode","errorText","statusText","catch","error","message","URL","StopPointsDiscoveryService","options","upperLeft","this","toTile","lowerRight","urls","y","x","push","pipe","mergeMap","http","reduce","accumulator","value","concat","entries","map","_ref","_ref2","slicedToArray","key","join","lon","lat","zoom","n","Math","pow","floor","log","tan","PI","cos","StopMonitoringService","console","time","t","concatMap","href","isValid","filter","undefined","take","tap","timeEnd","v","index","slice","lastIndexOf","call","estimatedCalls","Date","parse","expectedDepartureTime","setFullYear","actions","createActions","LINES_DISCOVERY","SUCCESS","FAILURE","STOP_POINTS_DISCOVERY","STOP_MONITORING","ESTIMATED_TIMETABLE","StopMonitoringComponent","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","counter","initialize","dispose","_options","_this2","_this$props","length","onChange","defineProperty","timer","setInterval","_options2","_this$props2","onClose","clearInterval","_this$props3","values","Row","react_default","a","createElement","scope","dist_default","format","style","textTransform","directionName","publishedLineName","react_fontawesome_index_es","color","icon","Rows","datedVehicleJourneyRef","title","className","React","Component","selector","createSelector","connect","dispatch","failure","stopMonitoringService","subscribe","success","StopPointsDiscoveryComponent","ref","createRef","b","abs","update","stopPointIcon","L","iconUrl","shadowUrl","stopAreaIcon","center","current","addTo","markers","popups","scale","mousePosition","position","on","load","getZoom","bounds","getBounds","count","getLayers","contains","dx","diff","getEast","getWest","dy","getNorth","getSouth","getNorthWest","lng","getSouthEast","clearLayers","forEach","i","latlng","location","latitude","longitude","stopName","stopPointRef","alt","startsWith","marker","createPopup","addLayer","popup","getPopup","closePopup","autoClose","closeOnClick","closeButton","setLatLng","getLatLng","div","document","setContent","element","es","components_stop_monitoring_StopMonitoringComponent","ReactDOM","render","bindPopup","unmountComponentAtNode","unbindPopup","id","defaultProps","stopPointsDiscoveryService","library","add","faBus","App","components_stop_points_discovery_StopPointsDiscoveryComponent","src_App_0","getElementById"],"mappings":"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","file":"static/js/main.20bff904.chunk.js","sourcesContent":["import { handleActions } from 'redux-actions';\n\nconst reducers = handleActions(\n  {\n    'LINES_DISCOVERY/SUCCESS': (state, action) => ({ ...state, linesDiscovery: action.payload }),\n    'LINES_DISCOVERY/FAILURE': (state) => ({ ...state, linesDiscovery: [] }),\n    'STOP_POINTS_DISCOVERY/SUCCESS': (state, action) => ({ ...state, stopPointsDiscovery: action.payload }),\n    'STOP_POINTS_DISCOVERY/FAILURE': (state) => ({ ...state, stopPointsDiscovery: [] }),\n    'STOP_MONITORING/SUCCESS': (state, action) => {\n      const result = { ...state };\n      result.stopMonitoring[action.meta.name] = action.payload;\n      return result;\n    },\n    'STOP_MONITORING/FAILURE': (state, action) => {\n      const result = { ...state };\n      delete result.stopMonitoring[action.meta.name];\n      return result;\n    },\n    'ESTIMATED_TIMETABLE/SUCCESS': (state, action) => {\n      const result = { ...state };\n      result.estimatedTimetable[action.meta.name] = action.payload;\n      return result;\n    },\n    'ESTIMATED_TIMETABLE/FAILURE': (state, action) => {\n      const result = { ...state };\n      delete result.estimatedTimetable[action.meta.name];\n      return result;\n    },\n  },\n  {\n    linesDiscovery: [],\n    stopPointsDiscovery: [],\n    stopMonitoring: [],\n    estimatedTimetable: [],\n  },\n);\n\nexport default reducers;\n","import { createStore, applyMiddleware } from 'redux';\nimport thunk from 'redux-thunk';\nimport logger from 'redux-logger';\nimport reducers from './reducers';\n\nconst store = createStore(\n  reducers,\n  applyMiddleware(thunk, logger),\n);\n\nexport default store;\n","/* eslint-disable prefer-promise-reject-errors */\n/* eslint-disable no-console */\nimport { from } from 'rxjs';\nimport * as T from '../types';\n\nconst SiriService = {\n  get(url) {\n    const request = (process.env.NODE_ENV !== 'production') ? T.DEVELOPEMENT_HOST + url : url;\n\n    return from(fetch(request, { headers: { Accept: 'application/json' } })\n      .then((response) => {\n        if (response.ok) {\n          return response.json();\n        }\n        if (response.status === 400) {\n          return Promise.reject(response.json());\n        }\n        return Promise.reject({ errorCode: response.status, errorText: response.statusText });\n      })\n      .catch((error) => Promise.reject({ errorCode: 600, errorText: error.message })));\n  },\n};\n\nexport default SiriService;\n","/* eslint-disable max-len */\n/* eslint-disable no-mixed-operators */\n\nimport { from } from 'rxjs';\nimport { mergeMap, reduce } from 'rxjs/operators';\nimport http from './SiriService';\nimport * as T from '../types';\n\nconst URL = '/siri-xlite/stoppoints-discovery';\n\nconst StopPointsDiscoveryService = {\n  get(options) {\n    if (options) {\n      const upperLeft = this.toTile(options[T.UPPER_LEFT_LONGITUDE], options[T.UPPER_LEFT_LATITUDE], T.ZOOM);\n      const lowerRight = this.toTile(options[T.LOWER_RIGHT_LONGITUDE], options[T.LOWER_RIGHT_LATITUDE], T.ZOOM);\n      const urls = [];\n\n      for (let y = upperLeft[1]; y <= lowerRight[1]; y += 1) {\n        for (let x = upperLeft[0]; x <= lowerRight[0]; x += 1) {\n          const url = URL + T.SEP + x + T.SEP + y;\n          urls.push(url);\n        }\n      }\n\n      return from(urls).pipe(\n        mergeMap((url) => http.get(url)),\n        reduce((accumulator, value) => accumulator.concat(value)),\n      );\n    }\n    let url = URL;\n    url += options && `?${Object.entries(options).map(([key, value]) => `${key}=${value}`).join('&')}`;\n    return http.get(url);\n  },\n\n  toTile(lon, lat, zoom) {\n    const n = (2 ** zoom);\n    const x = Math.floor((lon + 180) / 360 * n);\n    const y = Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * n);\n    return [x, y];\n  },\n};\n\nexport default StopPointsDiscoveryService;\n","export const UPPER_LEFT_LONGITUDE = 'BoundingBox.UpperLeft.Longitude';\nexport const UPPER_LEFT_LATITUDE = 'BoundingBox.UpperLeft.Latitude';\nexport const LOWER_RIGHT_LONGITUDE = 'BoundingBox.LowerRight.Longitude';\nexport const LOWER_RIGHT_LATITUDE = 'BoundingBox.LowerRight.Latitude';\n\nexport const MONITORING_REF = 'MonitoringRef';\nexport const MAXIMUM_STOP_VISITS = 'MaximumStopVisits';\nexport const MAXIMUM_NUMBER_CALLS_OF_ONWARDS = 'MaximumNumberOfCalls.Onwards';\nexport const MAXIMUM_NUMBER_CALLS_OF_PREVIOUS = 'MaximumNumberOfCalls.Previous';\n\nexport const ZOOM = 14;\nexport const SEP = '/';\nexport const DEVELOPEMENT_HOST = 'https://localhost:8443';\n","/* eslint-disable no-console */\nimport { from } from 'rxjs';\n// eslint-disable-next-line object-curly-newline\nimport { mergeMap, reduce, concatMap, take, tap, filter } from 'rxjs/operators';\nimport http from './SiriService';\nimport * as T from '../types';\n\nconst StopMonitoringService = {\n  get(options) {\n    let url = '/siri-xlite/stop-monitoring';\n    url += T.SEP + options[T.MONITORING_REF];\n    console.time('stop-monitoring');\n    return http.get(url).pipe(\n      mergeMap((t) => from(t)),\n    ).pipe(\n      concatMap((t) => http.get(t.href), this.isValid),\n      filter((t) => t !== undefined),\n      take(10),\n      reduce((accumulator, value) => accumulator.concat(value), []),\n      tap(() => console.timeEnd('stop-monitoring')),\n    );\n  },\n\n  isValid(t, v) {\n    const { href } = t;\n    const index = href.slice(href.lastIndexOf('#') + 1);\n    const call = v.estimatedCalls[index];\n    const expectedDepartureTime = Date.parse(`1970-01-01T${call.expectedDepartureTime}`);\n    const now = (new Date()).setFullYear(1970, 0, 1);\n    if (expectedDepartureTime > now) {\n      return { ...v, index };\n    }\n    return undefined;\n  },\n};\n\nexport default StopMonitoringService;\n","import { createActions } from 'redux-actions';\nimport linesDiscoveryService from './services/LinesDiscoveryService';\nimport stopPointsDiscoveryService from './services/StopPointsDiscoveryService';\nimport stopMonitoringService from './services/StopMonitoringService';\nimport estimatedTimetableService from './services/EstimatedTimetableService';\n\nconst actions = createActions(\n  {\n    LINES_DISCOVERY: {\n      SUCCESS: (payload) => payload,\n      FAILURE: (payload) => payload,\n    },\n    STOP_POINTS_DISCOVERY: {\n      SUCCESS: (payload) => payload,\n      FAILURE: (payload) => payload,\n    },\n    STOP_MONITORING: {\n      SUCCESS: [\n        (payload) => payload,\n        (payload, name) => ({ name }),\n      ],\n      FAILURE: [\n        (payload) => payload,\n        (payload, name) => ({ name }),\n      ],\n    },\n    ESTIMATED_TIMETABLE: {\n      SUCCESS: [\n        (payload) => payload,\n        (payload, name) => ({ name }),\n      ],\n      FAILURE: [\n        (payload) => payload,\n        (payload, name) => ({ name }),\n      ],\n    },\n  },\n);\n\nexport const loadLinesDiscovery = (payload) => (dispatch) => linesDiscoveryService\n  .get(payload).subscribe(\n    (value) => dispatch(actions.linesDiscovery.success(value)),\n    (error) => dispatch(actions.linesDiscovery.failure(error)),\n  );\n\nexport const loadStopPointsDiscovery = (payload) => (dispatch) => stopPointsDiscoveryService\n  .get(payload).subscribe(\n    (value) => dispatch(actions.stopPointsDiscovery.success(value)),\n    (error) => dispatch(actions.stopPointsDiscovery.failure(error)),\n  );\n\nexport const loadStopMonitoring = (payload, name) => (dispatch) => stopMonitoringService\n  .get(payload).subscribe(\n    (value) => dispatch(actions.stopMonitoring.success(value, name)),\n    (error) => dispatch(actions.stopMonitoring.failure(error, name)),\n  );\n\nexport const loadEstimatedTimetable = (payload, name) => (dispatch) => estimatedTimetableService\n  .get(payload).subscribe(\n    (value) => dispatch(actions.estimatedTimetable.success(value, name)),\n    (error) => dispatch(actions.estimatedTimetable.failure(error, name)),\n  );\n\nexport default actions;\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport { createSelector } from 'reselect';\nimport Moment from 'react-moment';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\n\nimport actions, { loadStopMonitoring } from '../../actions';\nimport * as T from '../../types';\nimport './StopMonitoringComponent.scss';\n\nclass StopMonitoringComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.counter = 1;\n  }\n\n  componentDidMount() {\n    this.initialize();\n  }\n\n  componentWillUnmount() {\n    this.dispose();\n  }\n\n  initialize() {\n    const { name, length, onChange } = this.props;\n    const options = {\n      [T.MONITORING_REF]: name,\n      [T.MAXIMUM_STOP_VISITS]: length,\n    };\n    onChange(options);\n    this.timer = setInterval(() => {\n      this.counter += 1;\n      onChange(options);\n    }, 10000);\n  }\n\n  dispose() {\n    const { onClose, name, length } = this.props;\n    clearInterval(this.timer);\n    const options = {\n      [T.MONITORING_REF]: name,\n      [T.MAXIMUM_STOP_VISITS]: length,\n    };\n    onClose(options);\n  }\n\n  render() {\n    const { name, values } = this.props;\n\n    const Row = (props) => (\n      <tr>\n        <th scope=\"row\">\n          <Moment format=\"HH:mm\">\n            {`1970-01-01T${props.value.estimatedCalls[props.value.index].expectedDepartureTime}`}\n          </Moment>\n        </th>\n        <td style={{ textTransform: 'uppercase' }}>{props.value.directionName}</td>\n        <td style={{ textTransform: 'uppercase' }}>{props.value.publishedLineName}</td>\n        <td>\n          <FontAwesomeIcon style={{ color: 'steelblue' }} icon=\"bus\" />\n        </td>\n      </tr>\n    );\n\n    const Rows = (props) => ((props.values) ? (props.values.map(\n      (value) => <Row value={value} key={value.datedVehicleJourneyRef} />,\n    )) : (null));\n\n    const title = `#${this.counter} StopMonitoring: ${name}`;\n\n    return (\n      <div>\n        <h5>{title}</h5>\n        <table className=\"table table-sm table-hover\">\n          <thead>\n            <tr>\n              <th>Departure</th>\n              <th>Destination</th>\n              <th>Line</th>\n              <th>#</th>\n            </tr>\n          </thead>\n          <tbody>\n            <Rows values={values} />\n          </tbody>\n        </table>\n      </div>\n    );\n  }\n}\n\n/* eslint-disable react/forbid-prop-types */\nStopMonitoringComponent.propTypes = {\n  name: PropTypes.string.isRequired,\n  length: PropTypes.number.isRequired,\n  values: PropTypes.array.isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n  onClose: (options) => dispatch(actions.stopMonitoring.failure({}, options[T.MONITORING_REF])),\n  onChange: (options) => dispatch(loadStopMonitoring(options, options[T.MONITORING_REF])),\n});\n\nconst selector = createSelector((state, props) => state.stopMonitoring[props.name],\n  (value) => value || []);\n\nconst mapStateToProps = (state, props) => ({\n  name: props.name,\n  length: props.length,\n  values: selector(state, props),\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(StopMonitoringComponent);\n","/* eslint-disable react/require-default-props */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { Provider, connect } from 'react-redux';\nimport { createSelector } from 'reselect';\nimport * as L from 'leaflet';\n\nimport store from '../../store';\nimport './StopPointsDiscoveryComponent.scss';\nimport actions, { loadStopPointsDiscovery } from '../../actions';\nimport * as T from '../../types';\nimport StopMonitoringComponent from '../stop-monitoring/StopMonitoringComponent';\n\nimport { } from 'leaflet-mouse-position';\n\nclass StopPointsDiscoveryComponent extends React.Component {\n  static diff(a, b) {\n    return a * b > 0 ? Math.abs(b - a) : Math.abs(a) + Math.abs(b);\n  }\n\n  constructor(props) {\n    super(props);\n    this.ref = React.createRef();\n  }\n\n  componentDidMount() {\n    this.initialize();\n  }\n\n  componentDidUpdate() {\n    const { value } = this.props;\n    this.update(value);\n  }\n\n  componentWillUnmount() {\n    this.dispose();\n  }\n\n  initialize() {\n    this.stopPointIcon = L.icon({\n      iconUrl: 'images/marker-icon.png',\n      shadowUrl: 'images/marker-shadow.png',\n    });\n\n    this.stopAreaIcon = L.icon({\n      iconUrl: 'images/marker-red-icon.png',\n      shadowUrl: 'images/marker-shadow.png',\n    });\n\n    const { center, zoom, url } = this.props;\n    // eslint-disable-next-line new-cap\n    this.map = new L.map(this.ref.current, {\n      center: L.latLng(center),\n      zoom,\n    });\n    L.tileLayer(url, {}).addTo(this.map);\n    this.markers = L.layerGroup([]).addTo(this.map);\n    this.popups = L.layerGroup([]).addTo(this.map);\n    L.control.scale().addTo(this.map);\n    L.control.mousePosition({ position: 'bottomright' }).addTo(this.map);\n\n    this.map.on('moveend', this.load, this);\n    this.load();\n  }\n\n  dispose() {\n    const { onClose } = this.props;\n    onClose();\n  }\n\n  load() {\n    const { zoom, onChange, onClose } = this.props;\n\n    if (this.map.getZoom() >= zoom) {\n      const bounds = this.map.getBounds();\n      const count = this.markers.getLayers().length;\n      if (!this.bounds || !this.bounds.contains(bounds) || count === 0) {\n        const dx = StopPointsDiscoveryComponent.diff(bounds.getEast(), bounds.getWest());\n        const dy = StopPointsDiscoveryComponent.diff(bounds.getNorth(), bounds.getSouth());\n        this.bounds = new L.LatLngBounds(\n          new L.LatLng(bounds.getSouth() - dy, bounds.getWest() - dx),\n          new L.LatLng(bounds.getNorth() + dy, bounds.getEast() + dx),\n        );\n        const options = {\n          [T.UPPER_LEFT_LONGITUDE]: this.bounds.getNorthWest().lng,\n          [T.UPPER_LEFT_LATITUDE]: this.bounds.getNorthWest().lat,\n          [T.LOWER_RIGHT_LONGITUDE]: this.bounds.getSouthEast().lng,\n          [T.LOWER_RIGHT_LATITUDE]: this.bounds.getSouthEast().lat,\n        };\n\n        onChange(options);\n      }\n    } else {\n      onClose();\n    }\n  }\n\n  update(values) {\n    // console.log('[DSU] update ');\n    // console.log(values);\n    this.markers.clearLayers();\n    this.popups.clearLayers();\n    if (values && values.length > 0) {\n      values.forEach((i) => {\n        const latlng = L.latLng(i.location.latitude, i.location.longitude);\n        const options = {\n          title: `${i.stopName}\\n${i.stopPointRef}`,\n          alt: i.stopPointRef,\n          icon: i.stopPointRef.startsWith('StopArea') ? this.stopAreaIcon : this.stopPointIcon,\n        };\n        const marker = L.marker(latlng, options);\n        marker.on('click', () => {\n          this.createPopup(marker);\n        });\n        this.markers.addLayer(marker);\n      });\n    }\n  }\n\n  createPopup(marker) {\n    let popup = marker.getPopup();\n    if (popup) {\n      popup.closePopup();\n    } else {\n      popup = L.popup({\n        autoClose: false,\n        closeOnClick: false,\n        closeButton: false,\n      });\n      popup.setLatLng(marker.getLatLng());\n\n      const div = document.createElement('div');\n      popup.setContent(div);\n      const element = (\n        <Provider store={store}>\n          <StopMonitoringComponent name={marker.options.alt} length={10} />\n        </Provider>\n      );\n      ReactDOM.render(element, div);\n\n      marker.bindPopup(popup);\n      marker.on('popupclose', () => {\n        ReactDOM.unmountComponentAtNode(div);\n        marker.unbindPopup();\n      });\n      this.popups.addLayer(popup);\n    }\n  }\n\n  render() {\n    return (<div id=\"map\" ref={this.ref} />);\n  }\n}\n\n/* eslint-disable react/forbid-prop-types */\nStopPointsDiscoveryComponent.propTypes = {\n  url: PropTypes.string.isRequired,\n  center: PropTypes.array.isRequired,\n  zoom: PropTypes.number.isRequired,\n  value: PropTypes.array.isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n};\n\n/* eslint-disable react/default-props-match-prop-types */\nStopPointsDiscoveryComponent.defaultProps = {\n  url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  center: [48.866667, 2.333333],\n  zoom: 16,\n  value: [],\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n  onClose: () => dispatch(actions.stopPointsDiscovery.failure({})),\n  onChange: (options) => dispatch(loadStopPointsDiscovery(options)),\n});\n\n// eslint-disable-next-line no-unused-vars\nconst selector = createSelector((state, props) => state.stopPointsDiscovery, (value) => value);\n\nconst mapStateToProps = (state, props) => ({\n  url: props.url,\n  center: props.center,\n  zoom: props.zoom,\n  value: selector(state, props),\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(StopPointsDiscoveryComponent);\n","/* eslint-disable react/jsx-filename-extension */\nimport React from 'react';\nimport 'bootstrap/dist/css/bootstrap.css';\nimport { library } from '@fortawesome/fontawesome-svg-core';\nimport { faBus } from '@fortawesome/free-solid-svg-icons';\nimport './App.scss';\nimport StopPointsDiscoveryComponent from './components/stop-points-discovery/StopPointsDiscoveryComponent';\n\nlibrary.add(faBus);\n\n// eslint-disable-next-line react/prefer-stateless-function\nclass App extends React.Component {\n  render() {\n    return (\n      <div className=\"App\">\n        <StopPointsDiscoveryComponent />\n      </div>\n    );\n  }\n}\n\nexport default App;\n","/* eslint-disable react/jsx-filename-extension */\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\n\nimport './index.scss';\nimport App from './App';\nimport store from './store';\n\nReactDOM.render((<Provider store={store}><App /></Provider>), document.getElementById('root'));\n"],"sourceRoot":""}