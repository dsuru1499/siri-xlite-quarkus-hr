(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{61:function(t,e,n){t.exports=n(83)},70:function(t,e,n){},75:function(t,e,n){},76:function(t,e,n){},81:function(t,e,n){},83:function(t,e,n){"use strict";n.r(e);var o=n(0),a=n.n(o),r=n(19),i=n.n(r),u=n(22),c=(n(70),n(24)),s=n(20),l=n(28),p=n(25),f=n(29),m=(n(71),n(23)),h=n(56),d=(n(75),n(7)),g=n(35),b=n(5),v=n(32),O=n(52),E=n(53),j=n.n(E),S=n(10),L=n(88),y=Object(L.a)({"LINES_DISCOVERY/SUCCESS":function(t,e){return Object(S.a)({},t,{linesDiscovery:e.payload})},"LINES_DISCOVERY/FAILURE":function(t){return Object(S.a)({},t,{linesDiscovery:[]})},"STOP_POINTS_DISCOVERY/SUCCESS":function(t,e){return Object(S.a)({},t,{stopPointsDiscovery:e.payload})},"STOP_POINTS_DISCOVERY/FAILURE":function(t){return Object(S.a)({},t,{stopPointsDiscovery:[]})},"STOP_MONITORING/SUCCESS":function(t,e){var n=Object(S.a)({},t);return n.stopMonitoring[e.meta.name]=e.payload,n},"STOP_MONITORING/FAILURE":function(t,e){var n=Object(S.a)({},t);return delete n.stopMonitoring[e.meta.name],n},"ESTIMATED_TIMETABLE/SUCCESS":function(t,e){var n=Object(S.a)({},t);return n.estimatedTimetable[e.meta.name]=e.payload,n},"ESTIMATED_TIMETABLE/FAILURE":function(t,e){var n=Object(S.a)({},t);return delete n.estimatedTimetable[e.meta.name],n}},{linesDiscovery:[],stopPointsDiscovery:[],stopMonitoring:[],estimatedTimetable:[]}),T=Object(v.c)(y,Object(v.a)(O.a,j.a)),I=(n(76),n(87)),C=n(27),M=n(57),P={absolute:function(t){return new RegExp("^(?:[a-z]+:)?//","i").test(t)},get:function(t){var e=t;return Object(M.a)(fetch(e,{headers:{Accept:"application/json"}}).then(function(t){return t.ok?t.json():400===t.status?Promise.reject(t.json()):Promise.reject({errorCode:t.status,errorText:t.statusText})}).catch(function(t){return Promise.reject({errorCode:600,errorText:t.message})}))}},R=n(58),k=n(89),D="/siri-xlite/stoppoints-discovery",U={get:function(t){if(t){for(var e=this.toTile(t["BoundingBox.UpperLeft.Longitude"],t["BoundingBox.UpperLeft.Latitude"],14),n=this.toTile(t["BoundingBox.LowerRight.Longitude"],t["BoundingBox.LowerRight.Latitude"],14),o=[],a=e[1];a<=n[1];a+=1)for(var r=e[0];r<=n[0];r+=1){var i=D+"/"+r+"/"+a;o.push(i)}return Object(M.a)(o).pipe(Object(R.a)(function(t){return P.get(t)}),Object(k.a)(function(t,e){return t.concat(e)}))}var u=D;return u+=t&&"?".concat(Object.entries(t).map(function(t){var e=Object(C.a)(t,2),n=e[0],o=e[1];return"".concat(n,"=").concat(o)}).join("&")),P.get(u)},toTile:function(t,e,n){var o=Math.pow(2,n);return[Math.floor((t+180)/360*o),Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*o)]}},x=n(84),B=n(85),w=n(86),N=n(90),A={get:function(t){var e="/siri-xlite/stop-monitoring";return e+="/"+t.MonitoringRef,console.time("stop-monitoring"),P.get(e).pipe(Object(R.a)(function(t){return Object(M.a)(t)})).pipe(Object(x.a)(function(t){return P.get(t.href)},this.valid),Object(B.a)(function(t){return void 0!==t}),Object(w.a)(10),Object(k.a)(function(t,e){return t.concat(e)},[]),Object(N.a)(function(){return console.timeEnd("stop-monitoring")}))},valid:function(t,e){var n=t.href,o=n.slice(n.lastIndexOf("#")+1),a=e.estimatedCalls[o];if(Date.parse("1970-01-01T".concat(a.expectedDepartureTime))>(new Date).setFullYear(1970,0,1))return Object(S.a)({},e,{index:o})}},_=Object(I.a)({LINES_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_POINTS_DISCOVERY:{SUCCESS:function(t){return t},FAILURE:function(t){return t}},STOP_MONITORING:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]},ESTIMATED_TIMETABLE:{SUCCESS:[function(t){return t},function(t,e){return{name:e}}],FAILURE:[function(t){return t},function(t,e){return{name:e}}]}}),z=_,F=n(54),V=n.n(F),W=n(55),Y=(n(81),function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).counter=1,n}return Object(f.a)(e,t),Object(s.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"initialize",value:function(){var t,e=this,n=this.props,o=n.name,a=n.length,r=n.onChange,i=(t={},Object(d.a)(t,"MonitoringRef",o),Object(d.a)(t,"MaximumStopVisits",a),t);r(i),this.timer=setInterval(function(){e.counter+=1,r(i)},1e4)}},{key:"dispose",value:function(){var t,e=this.props,n=e.onClose,o=e.name,a=e.length;clearInterval(this.timer),n((t={},Object(d.a)(t,"MonitoringRef",o),Object(d.a)(t,"MaximumStopVisits",a),t))}},{key:"render",value:function(){var t=this.props,e=t.name,n=t.values,o=function(t){return a.a.createElement("tr",null,a.a.createElement("th",{scope:"row"},a.a.createElement(V.a,{format:"HH:mm"},"1970-01-01T".concat(t.value.estimatedCalls[t.value.index].expectedDepartureTime))),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.directionName),a.a.createElement("td",{style:{textTransform:"uppercase"}},t.value.publishedLineName),a.a.createElement("td",null,a.a.createElement(W.a,{style:{color:"steelblue"},icon:"bus"})))},r=function(t){return t.values?t.values.map(function(t){return a.a.createElement(o,{value:t,key:t.datedVehicleJourneyRef})}):null},i="#".concat(this.counter," StopMonitoring: ").concat(e);return a.a.createElement("div",null,a.a.createElement("h5",null,i),a.a.createElement("table",{className:"table table-sm table-hover"},a.a.createElement("thead",null,a.a.createElement("tr",null,a.a.createElement("th",null,"Departure"),a.a.createElement("th",null,"Destination"),a.a.createElement("th",null,"Line"),a.a.createElement("th",null,"#"))),a.a.createElement("tbody",null,a.a.createElement(r,{values:n}))))}}]),e}(a.a.Component)),G=Object(g.a)(function(t,e){return t.stopMonitoring[e.name]},function(t){return t||[]}),J=Object(u.b)(function(t,e){return{name:e.name,length:e.length,values:G(t,e)}},function(t){return{onClose:function(e){return t(z.stopMonitoring.failure({},e.MonitoringRef))},onChange:function(e){return t((n=e,o=e.MonitoringRef,function(t){return A.get(n).subscribe(function(e){return t(_.stopMonitoring.success(e,o))},function(e){return t(_.stopMonitoring.failure(e,o))})}));var n,o}}})(Y),H=(n(82),function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(l.a)(this,Object(p.a)(e).call(this,t))).ref=a.a.createRef(),n}return Object(f.a)(e,t),Object(s.a)(e,null,[{key:"diff",value:function(t,e){return t*e>0?Math.abs(e-t):Math.abs(t)+Math.abs(e)}}]),Object(s.a)(e,[{key:"componentDidMount",value:function(){this.initialize()}},{key:"componentDidUpdate",value:function(){var t=this.props.value;this.update(t)}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"initialize",value:function(){this.stopPointIcon=b.icon({iconUrl:"images/marker-icon.png",shadowUrl:"images/marker-shadow.png"}),this.stopAreaIcon=b.icon({iconUrl:"images/marker-red-icon.png",shadowUrl:"images/marker-shadow.png"});var t=this.props,e=t.center,n=t.zoom,o=t.url;this.map=new b.map(this.ref.current,{center:b.latLng(e),zoom:n}),b.tileLayer(o,{}).addTo(this.map),this.markers=b.layerGroup([]).addTo(this.map),this.popups=b.layerGroup([]).addTo(this.map),b.control.scale().addTo(this.map),b.control.mousePosition({position:"bottomright"}).addTo(this.map),this.map.on("moveend",this.load,this),this.load()}},{key:"dispose",value:function(){(0,this.props.onClose)()}},{key:"load",value:function(){var t=this.props,n=t.zoom,o=t.onChange,a=t.onClose;if(this.map.getZoom()>=n){var r=this.map.getBounds(),i=this.markers.getLayers().length;if(!this.bounds||!this.bounds.contains(r)||0===i){var u,c=e.diff(r.getEast(),r.getWest()),s=e.diff(r.getNorth(),r.getSouth());this.bounds=new b.LatLngBounds(new b.LatLng(r.getSouth()-s,r.getWest()-c),new b.LatLng(r.getNorth()+s,r.getEast()+c)),o((u={},Object(d.a)(u,"BoundingBox.UpperLeft.Longitude",this.bounds.getNorthWest().lng),Object(d.a)(u,"BoundingBox.UpperLeft.Latitude",this.bounds.getNorthWest().lat),Object(d.a)(u,"BoundingBox.LowerRight.Longitude",this.bounds.getSouthEast().lng),Object(d.a)(u,"BoundingBox.LowerRight.Latitude",this.bounds.getSouthEast().lat),u))}}else a()}},{key:"update",value:function(t){var e=this;this.markers.clearLayers(),this.popups.clearLayers(),t&&t.length>0&&t.forEach(function(t){var n=b.latLng(t.location.latitude,t.location.longitude),o={title:"".concat(t.stopName,"\n").concat(t.stopPointRef),alt:t.stopPointRef,icon:t.stopPointRef.startsWith("StopArea")?e.stopAreaIcon:e.stopPointIcon},a=b.marker(n,o);a.on("click",function(){e.createPopup(a)}),e.markers.addLayer(a)})}},{key:"createPopup",value:function(t){var e=t.getPopup();if(e)e.closePopup();else{(e=b.popup({autoClose:!1,closeOnClick:!1,closeButton:!1})).setLatLng(t.getLatLng());var n=document.createElement("div");e.setContent(n);var o=a.a.createElement(u.a,{store:T},a.a.createElement(J,{name:t.options.alt,length:10}));i.a.render(o,n),t.bindPopup(e),t.on("popupclose",function(){i.a.unmountComponentAtNode(n),t.unbindPopup()}),this.popups.addLayer(e)}}},{key:"render",value:function(){return a.a.createElement("div",{id:"map",ref:this.ref})}}]),e}(a.a.Component));H.defaultProps={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",center:[48.866667,2.333333],zoom:16,value:[]};var Z=Object(g.a)(function(t,e){return t.stopPointsDiscovery},function(t){return t}),q=Object(u.b)(function(t,e){return{url:e.url,center:e.center,zoom:e.zoom,value:Z(t,e)}},function(t){return{onClose:function(){return t(z.stopPointsDiscovery.failure({}))},onChange:function(e){return t((n=e,function(t){return U.get(n).subscribe(function(e){return t(_.stopPointsDiscovery.success(e))},function(e){return t(_.stopPointsDiscovery.failure(e))})}));var n}}})(H);m.b.add(h.a);var K=function(t){function e(){return Object(c.a)(this,e),Object(l.a)(this,Object(p.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(s.a)(e,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(q,null))}}]),e}(a.a.Component);i.a.render(a.a.createElement(u.a,{store:T},a.a.createElement(K,null)),document.getElementById("root"))}},[[61,1,2]]]);
//# sourceMappingURL=main.9012da3a.chunk.js.map